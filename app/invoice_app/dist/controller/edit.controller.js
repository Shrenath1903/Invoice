var invoiceRef;sap.ui.define(["sap/ui/core/mvc/Controller","sap/ui/model/json/JSONModel","sap/m/MessageBox","./validation","sap/ui/core/Fragment"],(e,t,o,i,a)=>{"use strict";return e.extend("invoiceapp.controller.edit",{onInit(e){invoiceRef=this;var o=new t;this.getView().setModel(o,"invoiceModel");var i=new t;this.getView().setModel(i,"invoiceItemModel");var a=new t;this.getView().setModel(a,"visibilityModel");var n=new t;this.getView().setModel(n,"mailModel");var r=this.getOwnerComponent().getRouter();r.getRoute("edit").attachPatternMatched(this._onObjectMatched,this);this.setheaderImage()},setheaderImage:function(){var e=jQuery.sap.getModulePath("invoiceapp","/Image/invoiceFormat-1.png");var t=jQuery.sap.getModulePath("invoiceapp","/Image/invoiceFormat-2.png");var o={img_1:e,img_2:t};var i=new sap.ui.model.json.JSONModel(o);this.getView().setModel(i,"imageModel")},_onObjectMatched:function(e){var t=e.getParameter("arguments");var o=this.getView().getModel("visibilityModel");if(t.po_no!="temp"){o.setProperty("/v_local",false);o.setProperty("/v_db",true);this.po_no=t.po_no;this.loadData(this.po_no)}else{o.setProperty("/v_local",true);o.setProperty("/v_db",false)}},loadData:function(e){var t=this.getView().getModel("invoiceModel");var o=this.getView().getModel();var i=`/Invoice(po_no=${e})`;o.read(i,{urlParameters:{$expand:"Items"},success:function(e,o){var i=e;if(e.Items){invoiceRef.loadInvoiceItemModel(e)}t.setData(e);console.log(i)},error:function(e){sap.m.MessageToast.show("Error downloading PDF");console.error("Error downloading PDF:",e)}})},loadInvoiceItemModel:function(e){var t=e.Items.results;var o=this.getView().getModel("invoiceItemModel");o.setData({invoiceItems:t});console.log(o)},updateInvoice:function(){var e=this.getView().getModel("invoiceModel");var t=e.oData;delete t.createdBy;delete t.createdAt;console.log(t);var i=`/Invoice(po_no=${this.po_no})`;var a=this.getView().getModel();a.update(i,t,{success:function(e,t){o.success("Successfully Updated")},error:function(e){o.error("Error while updating the data")}})},onDownloadPDF:function(e){if(e&&e.getParameter){var t=e}else{var t=this.po_no}var o=`/PDFEntity(po_no=${t})`;var i=this.getView().getModel().sServiceUrl;var a=i.indexOf("/")===2?i.substring(2):i;var n=a+o+"/pdf";window.open(n,"_blank")},downloadInvoice:function(e){if(this._oDialog)this._oDialog.close();var t=this.getView().getModel("invoiceModel");var o=this.getView().getModel("invoiceItemModel");var i=t.oData;var a=[];if(o.getData().invoiceItems){a=o.getData().invoiceItems}for(var n=0;a.length>n;n++){a[n].po_no_po_no=this.po_no}i.Items=o.oData.invoiceItems;if(i){this._createEntity(i)}else{MessageToast.show("No data was there.")}},_createEntity:function(e){console.log(e);var t=this.getView().getModel();var o=`/Invoice`;t.create(o,e,{success:function(e,t){invoiceRef.po_no=e.po_no;invoiceRef.onDownloadPDF()},error:function(e){sap.m.MessageToast.show("Error downloading PDF");console.error("Error downloading PDF:",e)}})},onAddItem:function(){var e=this.getView().getModel("invoiceItemModel");var t={description:"",qty:"",rate:"",amount:""};var o=e.getProperty("/invoiceItems")||[];o.push(t);e.setProperty("/invoiceItems",o)},testData:function(){var e={invoice_no:"101",date:"2024-12-04",company_name:"sap",Company_gst_no:"37B76C238B7E1Z5",bill_to:"Germany",ship_to:"Pondy",bill_from_name:"SAP Business",bill_from_address:"123 SAP St.",bill_from_city:"Bangalore",bill_from_zip:"560001",bill_from_country:"India",payment_terms:"Cash",due_date:"2024-12-10",sub_total:4500,discount:200,discountPercent:10,tax:500,shipping:300,total:5e3,amount_paid:100,balance_due:4900,Notes:"Good",Terms:"no",Currency:"INR",mail_id:"shrenathuiux@gmail.com",text:"This is a test invoice",bill_to_name:"John Doe",bill_to_city:"Berlin",bill_to_address:"456 ABC Road",bill_to_zip:10115,bill_to_country:"Germany",template:1};var t=this.getView().getModel("invoiceModel");t.setData(e);var o=this.getView().getModel("invoiceItemModel");var i={description:"cpu",qty:"10",rate:"45",amount:"4500"};var a=o.getProperty("/invoiceItems")||[];a.push(i);o.setProperty("/invoiceItems",a)},onNumbervalidation:function(e){validateNumber(e)},onCalAmount:function(e){console.log(e);invoiceRef.setInitialSelectState(e);var t=this.byId("invoiceTable");var o=t.getItems();var i=this.getView().getModel("invoiceItemModel");var a=i.getData();o.forEach((e,t)=>{var o=e.getBindingContext("invoiceItemModel").getObject();var i=parseFloat(o.qty)||0;var n=parseFloat(o.rate)||0;o.amount=i*n;a.invoiceItems[t].amount=o.amount});i.refresh();invoiceRef.calculateSubTotal(e)},calculateSubTotal:function(e){invoiceRef.setInitialSelectState(e);var t=this.getView().getModel("invoiceItemModel");var o=this.getView().getModel("invoiceModel");var i=t.getProperty("/invoiceItems");var a=i.reduce((e,t)=>e+(parseFloat(t.amount)||0),0);o.setProperty("/sub_total",a)},onDiscounted:function(e){invoiceRef.setInitialSelectState(e);var t=this.getView().getModel("invoiceModel");var o=t.getProperty("/sub_total");var i=t.getProperty("/discountPercent");if(o){var a=o*i/100;var n=o-a;t.setProperty("/discount",n)}},onCalculateTotal:function(e){invoiceRef.setInitialSelectState(e);var t=this.getView().getModel("invoiceModel");var o=parseFloat(t.getProperty("/discount"))||0;var i=parseFloat(t.getProperty("/tax"))||0;var a=parseFloat(t.getProperty("/shipping"))||0;var n=o+i+a;t.setProperty("/total",n.toFixed(2))},onCalAmtPaid:function(e){invoiceRef.setInitialSelectState(e);var t=this.getView().getModel("invoiceModel");var o=parseFloat(t.getProperty("/total"))||0;var i=parseFloat(t.getProperty("/amount_paid"))||0;var a=o-i;t.setProperty("/balance_due",a)},onDeleteItem:function(e){var t=e.getSource().getBindingContext("invoiceItemModel");var o=t.getPath();var i=this.getView().getModel("invoiceItemModel");var a=i.getProperty("/invoiceItems");var n=parseInt(o.split("/").pop(),10);a.splice(n,1);i.setProperty("/invoiceItems",a)},setInitialSelectState:function(e){e.getSource().setValueState("None")},onValidation:function(e){invoiceRef.setInitialSelectState(e)},onOpenPopover:function(){var e=this.getView();if(!this._oDialog){this._oDialog=sap.ui.xmlfragment(e.getId(),"invoiceapp.view.mailPopOver",this);e.addDependent(this._oDialog);this._oDialog.open()}else{this._oDialog.open()}},onMailPopup:function(){if(this._oDialog){this._oDialog.close()}},onSubmit:function(){var e=this.getView().getModel("mailModel").oData;var t=e.mail_id;var o=e.text;if(!t){MessageToast.show("Please provide Mail Id.");return}var i={mail_id:t,text:o};var a=this.getView().getModel();var n="/mail";a.create(n,i,{success:function(e,t){MessageToast.show("Mail Send !")},error:function(e){var t=JSON.parse(e.responseText);invoiceRef._showServiceError(t)}});this._oDialog.close()},onTemplateclick:function(){var e=this.getView();if(!this.template_dialog){this.template_dialog=sap.ui.xmlfragment(e.getId(),"invoiceapp.view.templatePopOver",this);e.addDependent(this.template_dialog);this.template_dialog.open()}else{this.template_dialog.open()}},onImageSelect:function(e){var t=this.getView().getModel("invoiceModel");const o=e.getSource().getCustomData()[0].getValue();if(o==="image_1"){t.setProperty("/template","1");console.log("Image 1 selected")}else if(o==="image_2"){t.setProperty("/template","2");console.log("Image 2 selected")}},ontemplatePopOver:function(){if(this.template_dialog){this.template_dialog.close()}}})});
//# sourceMappingURL=edit.controller.js.map